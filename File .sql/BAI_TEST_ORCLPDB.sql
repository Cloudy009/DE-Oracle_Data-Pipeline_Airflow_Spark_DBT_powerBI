--T?O B?NG
--b?ng Khách Hàng:
CREATE TABLE BAI_TEST.KHACH_HANG (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MA_KH VARCHAR2(20) UNIQUE,
    TEN_KH NVARCHAR2(200)
);

--b?ng S?N PH?M:
CREATE TABLE SAN_PHAM (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MA_SAN_PHAM VARCHAR2(20) UNIQUE NOT NULL,
    TEN_SAN_PHAM NVARCHAR2(500),
    NHOM_SAN_PHAM NVARCHAR2(100)
);


CREATE TABLE NHAN_VIEN (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MA_NV VARCHAR2(20) UNIQUE NOT NULL,
    TEN_NV NVARCHAR2(200)
);

CREATE TABLE CHI_NHANH (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MA_CN VARCHAR2(20) UNIQUE NOT NULL,
    TEN_CN NVARCHAR2(200),
    TINH_THANH_NV NVARCHAR2(100)
);


CREATE TABLE KPI_NAM (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAM NUMBER(4) NOT NULL,
    MA_CN VARCHAR2(20) NOT NULL,
    KPI NUMBER,
    CONSTRAINT FK_KPI_CN FOREIGN KEY (MA_CN) REFERENCES CHI_NHANH(MA_CN),
);


CREATE TABLE BAN_HANG (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NGAY_HACH_TOAN DATE,
    DON_HANG VARCHAR2(50) UNIQUE NOT NULL,
    MA_KH VARCHAR2(20),
    MA_SAN_PHAM VARCHAR2(20),
    SO_LUONG_BAN NUMBER,
    DON_GIA NUMBER,
    DOANH_THU NUMBER,
    GIA_VON_HANG_HOA NUMBER,
    MA_NV VARCHAR2(20),
    MA_CN VARCHAR2(20),
    CONSTRAINT FK_BANHANG_KH FOREIGN KEY (MA_KH) REFERENCES KHACH_HANG(MA_KH),
    CONSTRAINT FK_BANHANG_SANPHAM FOREIGN KEY (MA_SAN_PHAM) REFERENCES SAN_PHAM(MA_SAN_PHAM),
    CONSTRAINT FK_BANHANG_NV FOREIGN KEY (MA_NV) REFERENCES NHAN_VIEN(MA_NV),
    CONSTRAINT FK_BANHANG_CN FOREIGN KEY (MA_CN) REFERENCES CHI_NHANH(MA_CN)
);
ALTER TABLE BAN_HANG
ADD CONSTRAINT UQ_DONHANG_SANPHAM UNIQUE (DON_HANG, MA_SAN_PHAM);



select * from WEATHER_HISTORY;
CREATE TABLE WEATHER_HISTORY (
    datetime         DATE,
    datetimeEpoch    NUMBER,
    tempmax          NUMBER,
    tempmin          NUMBER,
    temp             NUMBER,
    feelslikemax     NUMBER,
    feelslikemin     NUMBER,
    feelslike        NUMBER,
    dew              NUMBER,
    humidity         NUMBER,
    precip           NUMBER,
    precipprob       NUMBER,
    precipcover      NUMBER,
    preciptype       VARCHAR2(100), -- L?u d?ng chu?i, ví d?: 'rain'
    snow             NUMBER,
    snowdepth        NUMBER,
    windgust         NUMBER,
    windspeed        NUMBER,
    winddir          NUMBER,
    pressure         NUMBER,
    cloudcover       NUMBER,
    visibility       NUMBER,
    solarradiation   NUMBER,
    solarenergy      NUMBER,
    uvindex          NUMBER,
    sunrise          VARCHAR2(20),
    sunriseEpoch     NUMBER,
    sunset           VARCHAR2(20),
    sunsetEpoch      NUMBER,
    moonphase        NUMBER,
    conditions       VARCHAR2(100),
    description      VARCHAR2(200),
    icon             VARCHAR2(50),
    stations         VARCHAR2(200), -- L?u d?ng chu?i, ví d?: '48820099999,48823099999'
    source           VARCHAR2(20)
);






select * from CHI_NHANH;
select * from KHACH_HANG;
select * from KPI_NAM;
select * from NHAN_VIEN;
select * from SAN_PHAM;
select * from BAN_HANG;
select * from WEATHER_HISTORY;


select COUNT(*) from BAN_HANG


SELECT constraint_name
FROM user_constraints
WHERE table_name = 'KPI_NAM'
  AND constraint_type = 'U';
--
ALTER TABLE KPI_NAM DROP CONSTRAINT UQ_KPI_NAM_CN;


TRUNCATE TABLE BAN_HANG;
TRUNCATE TABLE KPI_NAM;
TRUNCATE TABLE WEATHER_HISTORY;
TRUNCATE TABLE CHI_NHANH;
TRUNCATE TABLE NHAN_VIEN;
TRUNCATE TABLE SAN_PHAM;
TRUNCATE TABLE KHACH_HANG;

